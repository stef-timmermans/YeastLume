# YeastLume
Repository for the YeastLume data pipeline. Follow the directions below to configure the repository for your own purposes.

---

## 1. Initial Setup
Run the setup script for the repository. The script will exit on failure and assumes that Python, Pip, Conda, and Git are installed. It sets up a virtual environment, installs Python dependencies, and clones the utilized model ([BBDM](https://github.com/xuekt98/BBDM)).
```shell
./initial_setup.sh
```

---

## 2. Remote Data Hosting via Rclone
Hosting the training data can be done however you please, however this project was developed using Rclone—Hábrók's suggested data software module—with Google Cloud Platform. In order to correctly setup Google Drive as a storage space in a headless environment, ensure the following steps are taken on a **new fork** of the repository:

1. Create a new Google Cloud Platform project
2. Under "APIs and Services" → "Enabled APIs & services", click "+ Enable APIs and services" and search for and enable the Google Drive API.
3. Go to "APIs and Services" → "Credentials" and configure a basic consent screen. Configure for external use.
4. Under "Google Auth Platform" → "Data Access", add these scopes to the "Manually add scopes", and leave the resulting boxes ticked: `https://www.googleapis.com/auth/docs,https://www.googleapis.com/auth/drive,https://www.googleapis.com/auth/drive.metadata.readonly`. Note to save changes in the bottom of the pop-up.
5. Under "Google Auth Platform" → "Audience", add yourself as a test user (**ensure the GCP project, your Google Drive, and test user are all the same account**).
6. Under "APIs and Services" → "Credentials", click "+ Create credentials" and select for an OAuth Client ID of type "Desktop app".
7. From the pop-up, download the provided JSON from the bottom-left button.
8. Move the created JSON file into [`/accounts`](./accounts) and rename it to `drive.json`. It should automatically be ignored from tracking at this point.
9. Install [SOPS](https://getsops.io/docs/#download) and run the encryption script, which should create a key in [`/accounts`](./accounts) that can be fed into the decryption logic called by the remote data loader.
```shell
./encrypt.sh
```

*For more information about configuring a Google Cloud Platform project, please see the [University of Groningen Hábrók documentation](https://wiki.hpc.rug.nl/habrok/data_management/google_drive). To configure on Hábrók, see section "Loading and configuring the application".*


### Prevent Committing Output from Notebooks

Add this line to your shell configuration:
```shell
git config filter.strip-notebook-output.clean 'jupyter nbconvert --ClearOutputPreprocessor.enabled=True --to=notebook --stdin --stdout --log-level=ERROR'
```

**[Source](https://gist.github.com/33eyes/431e3d432f73371509d176d0dfb95b6e)**
